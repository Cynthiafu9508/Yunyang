# 云养APP HTML原型功能更新说明 v2.0

## 📅 更新日期
2025年10月16日

## 📋 更新概览

本次更新是一次重大功能优化，涉及商业化模块完善、每日签到系统、联系人管理优化等核心功能。

---

## 🎯 核心功能更新

### 1. 每日签到系统
**影响页面**: homepage.html, profile.html, chat.html

**功能描述**:
- 用户每日首次登录自动赠送50点心跳值
- 自动弹窗提示："🎉 每日签到成功！"
- 有效期至当日24:00，次日00:00自动清零
- 优先消耗每日赠送心跳值

**实现逻辑**:
- 使用localStorage的`lastSignInDate`记录上次签到日期
- 页面加载时对比当前日期
- 如果日期不同，自动赠送并弹窗
- 心跳值消耗顺序：每日赠送 → 永久心跳值

---

### 2. 商业化模块完善
**影响页面**: profile.html, recharge.html

#### 2.1 充值页面 (recharge.html)

**会员套餐**:
1. 周度会员 ¥9.9
   - 1000次心跳值
   - 赠送3个人物创建额度
   - 7天VIP会员

2. 月度会员 ¥19.9
   - 2500次心跳值
   - 赠送7个人物创建额度
   - 30天VIP会员

**心动充值（已移除自定义充值）**:
1. ¥3 - 200次心跳值 + 1个人物创建额度
2. ¥6 - 500次心跳值 + 3个人物创建额度
3. ¥12 - 1200次心跳值 + 7个人物创建额度

**已移除功能**:
- ❌ 自定义充值金额输入框
- ❌ 月度会员的"推荐"标记和黄色边框

#### 2.2 个人中心 (profile.html)

**新增功能**:
- ✅ 心跳值余额显示（总计：永久+每日赠送）
- ✅ VIP会员标识（金色徽章）
- ✅ 会员到期时间显示
- ✅ 已创建人物数量展示
- ✅ "订阅充值"入口（合并了会员订阅和心动充值）

**移除功能**:
- ❌ 账号安全
- ❌ 消息设置
- ❌ 关于我们
- ❌ 帮助与反馈
- ❌ 朋友圈
- ❌ "今日赠送"独立显示卡片

**新增功能**:
- ✅ 联系我们（显示客服邮箱、微信、工作时间）

**资产卡片优化**:
- 由3个减少为2个
- ❤️ 心跳值（显示总计）
- 👤 已创建人物

---

### 3. 聊天功能优化
**影响页面**: chat.html

**新增功能**:
- ✅ 右上角显示心跳值图标（❤️）和实时余额
- ✅ 每次发送消息消耗1点心跳值
- ✅ 心跳值不足时提示充值
- ✅ 点击心跳图标查看详细信息（永久心跳值、今日赠送、消耗规则）

**移除功能**:
- ❌ 表情按钮（😊）
- ❌ 右上角"更多"按钮（⋯）

**消耗逻辑**:
```
发送消息时：
1. 优先消耗今日赠送心跳值
2. 今日赠送用完后消耗永久心跳值
3. 两者都不足时提示充值
```

**心跳值详情弹窗**:
```
💖 心跳值详情

总计：2,400 个心跳值

• 永久心跳值：2,350
• 今日赠送：50（24点清零）

每次发送消息消耗1点心跳值
优先消耗今日赠送心跳值
```

---

### 4. 联系人管理优化
**影响页面**: contacts.html

**核心变更**:
- ✅ 联系人与已创建人物列表绑定
- ✅ 动态读取localStorage的`characterList`
- ✅ 按首字母自动分组显示
- ✅ 点击联系人跳转到chat.html（带character参数）

**移除功能**:
- ❌ 心动管家（系统默认联系人）
- ❌ "⭐ 特别关注"分组

**默认数据**:
- 默认包含"小仙女Alice"一个联系人
- 空状态时显示提示和"立即创建"按钮

**数据结构**:
```javascript
characterList: [
  {
    id: "alice_001",
    name: "小仙女Alice",
    avatar: "A",
    createTime: "2025-10-16T..."
  }
]
```

---

### 5. 页面间数据打通

#### 5.1 心跳值数据同步
**涉及页面**: profile.html, chat.html, homepage.html, recharge.html

**数据结构**:
```javascript
localStorage: {
  heartBalance: 2350,           // 永久心跳值
  dailyHeartBalance: 50,        // 每日赠送（24点清零）
  lastSignInDate: "Wed Oct 16"  // 签到日期
}
```

**同步规则**:
- 所有页面显示总计（永久+今日赠送）
- 充值增加永久心跳值
- 聊天消耗优先使用今日赠送
- 24点自动清零今日赠送

#### 5.2 人物数据同步
**涉及页面**: profile.html, contacts.html, character-profile.html

**数据结构**:
```javascript
localStorage: {
  characterList: [...],         // 已创建人物列表
  characterCount: 5,            // 已创建数量（自动计算）
  createQuota: 10               // 剩余创建额度
}
```

**同步规则**:
- contacts.html从characterList读取并渲染
- profile.html显示characterCount
- 创建新人物时更新characterList

---

## 📊 各页面功能对比

### profile.html
| 功能模块 | v1.0 | v2.0 |
|---------|------|------|
| 心跳值显示 | ❌ | ✅ 总计显示 |
| VIP会员标识 | ❌ | ✅ 金色徽章 |
| 会员到期时间 | ❌ | ✅ |
| 已创建人物 | ❌ | ✅ |
| 朋友圈 | ✅ | ❌ |
| 账号安全 | ✅ | ❌ |
| 消息设置 | ✅ | ❌ |
| 关于我们 | ✅ | ❌ |
| 帮助与反馈 | ✅ | ❌ |
| 联系我们 | ❌ | ✅ |
| 订阅充值 | ❌ | ✅ |
| 每日签到弹窗 | ❌ | ✅ |

### chat.html
| 功能模块 | v1.0 | v2.0 |
|---------|------|------|
| 表情按钮 | ✅ | ❌ |
| 更多按钮 | ✅ | ❌ |
| 心跳值显示 | ❌ | ✅ |
| 心跳值消耗 | ❌ | ✅ |
| 充值提示 | ❌ | ✅ |

### contacts.html
| 功能模块 | v1.0 | v2.0 |
|---------|------|------|
| 心动管家 | ✅ | ❌ |
| 静态联系人列表 | ✅ | ❌ |
| 动态人物列表 | ❌ | ✅ |
| 按字母分组 | ✅ | ✅ |

### recharge.html
| 功能模块 | v1.0 | v2.0 |
|---------|------|------|
| 周度会员 | ❌ | ✅ 第一位 |
| 月度会员 | ❌ | ✅ 第二位 |
| 推荐标记 | ❌ | ❌ |
| ¥3充值 | ❌ | ✅ |
| ¥6充值 | ❌ | ✅ |
| ¥12充值 | ❌ | ✅ |
| 自定义充值 | ❌ | ❌ |

---

## 🗂️ localStorage数据结构总览

```javascript
{
  // 用户信息
  userToken: "xxx",
  userInfo: {...},
  
  // 资产数据
  heartBalance: 2350,                    // 永久心跳值
  dailyHeartBalance: 50,                 // 每日赠送（24点清零）
  characterCount: 5,                     // 已创建人物数量
  createQuota: 10,                       // 剩余创建额度
  
  // 人物数据
  characterList: [
    {
      id: "alice_001",
      name: "小仙女Alice",
      avatar: "A",
      createTime: "2025-10-16T..."
    }
  ],
  
  // 签到数据
  lastSignInDate: "Wed Oct 16 2025"     // 最后签到日期
}
```

---

## 🔄 关键用户流程

### 每日签到流程
```
用户打开APP
    ↓
进入homepage.html或profile.html
    ↓
自动检查lastSignInDate
    ↓
日期不同？
    ↓ 是
自动赠送50心跳值
    ↓
延迟500ms弹窗提示
    ↓
更新lastSignInDate
    ↓
24点后日期变化可再次领取
```

### 聊天消耗流程
```
用户发送消息
    ↓
检查心跳值余额
    ↓
优先消耗今日赠送心跳值
    ↓
今日赠送不足？
    ↓ 是
使用永久心跳值补足
    ↓
永久心跳值也不足？
    ↓ 是
弹窗提示充值
```

### 充值流程
```
点击"订阅充值"或心跳值卡片
    ↓
跳转recharge.html
    ↓
选择会员套餐或心动充值
    ↓
确认支付
    ↓
更新permanentHeartBalance
    ↓
更新createQuota
    ↓
显示充值成功
    ↓
2秒后返回profile.html
    ↓
余额自动更新
```

---

## ✅ 测试要点

### 每日签到测试
- [ ] 每日首次登录弹窗
- [ ] 同一天只弹窗一次
- [ ] 弹窗延迟500ms
- [ ] 24点后日期变化可再次领取
- [ ] 签到后心跳值+50

### 心跳值消耗测试
- [ ] 发送消息消耗1点
- [ ] 优先消耗今日赠送
- [ ] 今日赠送用完消耗永久
- [ ] 心跳值不足提示充值
- [ ] 右上角实时显示总计

### 充值功能测试
- [ ] 套餐选择正确
- [ ] 金额计算准确
- [ ] 充值成功后余额更新
- [ ] 返回页面余额同步

### 联系人管理测试
- [ ] 默认显示小仙女Alice
- [ ] 从characterList读取数据
- [ ] 按字母正确分组
- [ ] 点击跳转到聊天页面
- [ ] 空状态提示正确

### 数据同步测试
- [ ] profile显示正确的人物数量
- [ ] chat显示正确的心跳值
- [ ] contacts显示正确的人物列表
- [ ] 充值后所有页面余额同步

---

## 📝 文件清单

### HTML页面文件
1. login.html - 登录页面
2. password_login.html - 密码登录
3. forgot_password.html - 忘记密码
4. forgot_password_verify.html - 验证码验证
5. forgot_password_reset.html - 重置密码
6. homepage.html - 聊天主页（已添加自动签到）
7. chat.html - 聊天详情（已添加心跳值消耗）
8. contacts.html - 联系人列表（已绑定人物数据）
9. profile.html - 个人中心（已添加资产展示和充值入口）
10. upload.html - 上传照片创建人物
11. character-profile.html - 人物档案编辑
12. recharge.html - 充值中心（已完善套餐）
13. login_flow_diagram.html - 登录流程图
14. user_flow_diagram.html - 用户流程图

### 需求文档文件
1. login_需求文档.md
2. password_login_需求文档.md
3. forgot_password_需求文档.md
4. homepage_需求文档.md
5. chat_需求文档.md
6. contacts_需求文档.md
7. profile_需求文档.md（✅ 已更新v2.0）
8. upload_需求文档.md
9. character-profile_需求文档.md

---

## 🚀 下一步计划

### v2.1 待开发功能
- [ ] 完善更换头像功能（上传图片）
- [ ] 消费记录查询页面
- [ ] VIP特权详情页面
- [ ] 账号安全设置（修改密码、绑定手机）
- [ ] 我的人物详情页面（独立于联系人）

### v2.2 待开发功能
- [ ] 签到日历
- [ ] 成就系统
- [ ] 好友邀请奖励
- [ ] 分享功能
- [ ] 消息推送设置

---

## 📧 联系方式

如有疑问或建议，请联系：
- 客服邮箱：17621792630@163.com
- 官方客服微信：17621792630
- 官方小红书账号：Dokidoki官方号
- 工作时间：9:00-18:00

---

**文档版本**: v2.0
**最后更新**: 2025年10月16日
**维护者**: 云养开发团队

