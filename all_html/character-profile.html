<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>äººç‰©æ¡£æ¡ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #f0e5ff, #d9c6e0);
            width: 100vw;
            height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* iPhone 16 å®¹å™¨ */
        .iphone-container {
            width: 393px;
            height: 852px;
            margin: 20px auto;
            background: #000;
            border-radius: 50px;
            padding: 10px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #f0e5ff, #d9c6e0);
            border-radius: 40px;
            overflow: hidden;
            position: relative;
        }
        
        /* çŠ¶æ€æ  */
        .status-bar {
            height: 44px;
            background: rgba(255,255,255,0.95);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
            color: #000;
        }
        
        .time {
            font-weight: bold;
        }
        
        .battery-info {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .app-content {
            height: calc(100% - 44px);
            display: flex;
            flex-direction: column;
        }
        
        .navbar {
            background-color: rgba(255, 255, 255, 0.95);
            color: #6a4c93;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(217, 198, 224, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .navbar h1 {
            font-size: 18px;
            margin: 0;
            font-weight: 600;
        }
        
        .more-button {
            background: none;
            border: none;
            font-size: 20px;
            color: #6a4c93;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            padding: 5px 10px;
        }
        
        .back-button {
            background: none;
            border: none;
            color: #6a4c93;
            font-size: 16px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        
        .edit-button {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        
        .profile-content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
        }
        
        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.3);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 154, 158, 0.4);
        }
        
        .avatar-edit-icon {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 32px;
            height: 32px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .ai-badge {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            color: #6a4c93;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            position: absolute;
            top: -12px;
            left: 20px;
            box-shadow: 0 3px 12px rgba(168, 237, 234, 0.4);
            z-index: 2;
        }
        
        .profile-fields {
            display: flex;
            flex-direction: column;
            gap: 25px;
            align-items: center;
        }
        
        .field-group {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 6px 30px rgba(106, 76, 147, 0.08);
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .field-group:hover {
            box-shadow: 0 8px 40px rgba(106, 76, 147, 0.12);
        }
        
        .field-label {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #6a4c93;
        }
        
        .field-icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            font-size: 16px;
        }
        
        .field-content {
            position: relative;
        }
        
        .field-input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 14px;
            color: #6a4c93;
            line-height: 1.5;
            resize: none;
            outline: none;
            font-family: inherit;
        }
        
        .field-input:read-only {
            cursor: default;
        }
        
        .field-input.editable {
            background: rgba(240, 229, 255, 0.5);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid rgba(106, 76, 147, 0.2);
        }
        
        .field-input.editable:focus {
            border-color: #6a4c93;
            background: rgba(240, 229, 255, 0.8);
        }
        
        /* æ ‡ç­¾åŒ–å±•ç¤ºæ ·å¼ */
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .tag {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .tag-delete {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .tag-delete:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        .tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 154, 158, 0.4);
        }
        
        .tag.active {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            color: #6a4c93;
        }
        
        /* ä¸åŒå­—æ®µçš„æ ‡ç­¾é¢œè‰² */
        .tag.profession {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
        }
        
        .tag.personality {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            color: #6a4c93;
        }
        
        .tag.speaking {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
        }
        
        .tag-detail {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 12px;
            margin-top: 8px;
            font-size: 13px;
            color: #6a4c93;
            line-height: 1.4;
            border: 1px solid rgba(106, 76, 147, 0.1);
            display: none;
        }
        
        .tag-detail.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* èº«ä»½èƒŒæ™¯é€‰æ‹©æ ·å¼ */
        .identity-selector {
            background: rgba(240, 229, 255, 0.15);
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid rgba(106, 76, 147, 0.1);
            position: relative;
        }
        
        .identity-selector::before {
            content: 'ç‚¹å‡»é€‰æ‹©èº«ä»½';
            position: absolute;
            top: -8px;
            left: 12px;
            background: rgba(240, 229, 255, 0.9);
            color: #6a4c93;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .identity-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .identity-option {
            background: rgba(255, 255, 255, 0.8);
            color: #6a4c93;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(106, 76, 147, 0.2);
            position: relative;
        }
        
        .identity-option::before {
            content: '+';
            position: absolute;
            top: -2px;
            right: -2px;
            background: rgba(106, 76, 147, 0.8);
            color: white;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .identity-option:hover {
            background: rgba(106, 76, 147, 0.1);
            border-color: rgba(106, 76, 147, 0.4);
            transform: translateY(-1px);
        }
        
        .identity-option:hover::before {
            opacity: 1;
        }
        
        .identity-option.selected {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: white;
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 3px 12px rgba(255, 154, 158, 0.4);
        }
        
        .identity-option.selected::before {
            content: 'âœ“';
            background: rgba(255, 255, 255, 0.9);
            color: #ff9a9e;
            opacity: 1;
        }
        
        .custom-identity {
            background: rgba(106, 76, 147, 0.1);
            color: #6a4c93;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px dashed rgba(106, 76, 147, 0.4);
        }
        
        .custom-identity:hover {
            background: rgba(106, 76, 147, 0.2);
            border-color: rgba(106, 76, 147, 0.6);
            transform: translateY(-1px);
        }
        
        
        .edit-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }
        
        .field-group:hover .edit-icon {
            display: flex;
        }
        
        .save-button {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.3);
            margin: 30px auto;
            display: block;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .save-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(255, 154, 158, 0.3);
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 480px) {
            .iphone-container {
                width: 100vw;
                height: 100vh;
                margin: 0;
                border-radius: 0;
                padding: 0;
                box-shadow: none;
            }
            
            .screen {
                border-radius: 0;
            }
            
            .profile-content {
                padding: 15px;
            }
            
            .profile-avatar {
                width: 100px;
                height: 100px;
                font-size: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="iphone-container">
        <div class="screen">
            <div class="status-bar">
                <div class="time">9:41</div>
                <div class="battery-info">
                    <span>100%</span>
                    <div style="width: 24px; height: 12px; border: 1px solid #000; border-radius: 2px; position: relative;">
                        <div style="width: 20px; height: 8px; background: #000; border-radius: 1px; margin: 1px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="app-content">
                <div class="navbar">
                    <button class="back-button" onclick="goBack()">â† è¿”å›</button>
                    <h1>äººç‰©æ¡£æ¡ˆ</h1>
                    <button class="more-button" id="moreButton" onclick="showMenu()" style="display: none;">â‹¯</button>
                </div>
                
                <div class="profile-content">
                    <div class="profile-header">
                        <div class="profile-avatar" onclick="changeAvatar()">
                            <span id="avatarDisplay">ğŸ‘©</span>
                            <div class="avatar-edit-icon">âœï¸</div>
                        </div>
                    </div>
                    
                    <div class="profile-fields">
                        <div class="field-group" style="position: relative;">
                            <div class="ai-badge">ğŸ¤– AIæ™ºèƒ½ç”Ÿæˆ</div>
                            <div class="field-label">
                                <span class="field-icon">ğŸ’«</span>
                                äººç‰©æ˜µç§°
                            </div>
                            <div class="field-content">
                                <input type="text" class="field-input" id="nickname" value="æ¢¦å¹»å°ä»™å¥³" readonly>
                                <button class="edit-icon" onclick="editField('nickname')">âœï¸</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <div class="field-label">
                                <span class="field-icon">ğŸ‚</span>
                                å‡ºç”Ÿæ—¥æœŸ
                            </div>
                            <div class="field-content">
                                <input type="date" class="field-input" id="birthday" value="1995-06-15" readonly>
                                <button class="edit-icon" onclick="editField('birthday')">âœï¸</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <div class="field-label">
                                <span class="field-icon">ğŸ­</span>
                                èº«ä»½èƒŒæ™¯
                            </div>
                            <div class="field-content">
                                <div class="identity-selector">
                                    <div class="identity-options">
                                        <span class="identity-option" onclick="selectIdentity('æ€»è£')">æ€»è£</span>
                                        <span class="identity-option" onclick="selectIdentity('åŒ»ç”Ÿ')">åŒ»ç”Ÿ</span>
                                        <span class="identity-option" onclick="selectIdentity('è‰ºæœ¯å®¶')">è‰ºæœ¯å®¶</span>
                                        <span class="identity-option" onclick="selectIdentity('ç‰¹å·¥')">ç‰¹å·¥</span>
                                        <span class="identity-option" onclick="selectIdentity('æ•™æˆ')">æ•™æˆ</span>
                                        <span class="identity-option" onclick="selectIdentity('æ˜æ˜Ÿ')">æ˜æ˜Ÿ</span>
                                        <span class="custom-identity" onclick="addCustomIdentity()">+ è‡ªå®šä¹‰</span>
                                    </div>
                                </div>
                                <div class="tag-container" id="identity-tags">
                                    <span class="tag profession selected-identity" onclick="showTagDetail('identity', 'è‰ºæœ¯å®¶')">
                                        è‰ºæœ¯å®¶
                                        <button class="tag-delete" onclick="deleteTag(event, 'identity', 'è‰ºæœ¯å®¶')">Ã—</button>
                                    </span>
                                </div>
                                <div class="tag-detail" id="identity-detail"></div>
                                <button class="edit-icon" onclick="editField('identity')">âœï¸</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <div class="field-label">
                                <span class="field-icon">âœ¨</span>
                                æ€§æ ¼ç‰¹å¾
                            </div>
                            <div class="field-content">
                                <div class="identity-selector">
                                    <div class="identity-options">
                                        <span class="identity-option" onclick="selectPersonality('æ¸©æŸ”ä½“è´´')">æ¸©æŸ”ä½“è´´</span>
                                        <span class="identity-option" onclick="selectPersonality('éœ¸é“ä¸“ä¸€')">éœ¸é“ä¸“ä¸€</span>
                                        <span class="identity-option" onclick="selectPersonality('æµªæ¼«å¤šæƒ…')">æµªæ¼«å¤šæƒ…</span>
                                        <span class="identity-option" onclick="selectPersonality('æˆç†Ÿç¨³é‡')">æˆç†Ÿç¨³é‡</span>
                                        <span class="identity-option" onclick="selectPersonality('é˜³å…‰å¼€æœ—')">é˜³å…‰å¼€æœ—</span>
                                        <span class="identity-option" onclick="selectPersonality('ç¥ç§˜é«˜å†·')">ç¥ç§˜é«˜å†·</span>
                                        <span class="custom-identity" onclick="addCustomPersonality()">+ è‡ªå®šä¹‰</span>
                                    </div>
                                </div>
                                <div class="tag-container" id="personality-tags">
                                    <span class="tag personality selected-identity" onclick="showTagDetail('personality', 'æ¸©æŸ”ä½“è´´')">
                                        æ¸©æŸ”ä½“è´´
                                        <button class="tag-delete" onclick="deleteTag(event, 'personality', 'æ¸©æŸ”ä½“è´´')">Ã—</button>
                                    </span>
                                </div>
                                <div class="tag-detail" id="personality-detail"></div>
                                <button class="edit-icon" onclick="editField('personality')">âœï¸</button>
                            </div>
                        </div>
                        
                        
                        <div class="field-group">
                            <div class="field-label">
                                <span class="field-icon">ğŸ’¬</span>
                                è¯´è¯é£æ ¼
                            </div>
                            <div class="field-content">
                                <div class="identity-selector">
                                    <div class="identity-options">
                                        <span class="identity-option" onclick="selectSpeaking('æ¸©æŸ”å® æºº')">æ¸©æŸ”å® æºº</span>
                                        <span class="identity-option" onclick="selectSpeaking('éœ¸é“å¼ºåŠ¿')">éœ¸é“å¼ºåŠ¿</span>
                                        <span class="identity-option" onclick="selectSpeaking('ç”œè…»æ’’å¨‡')">ç”œè…»æ’’å¨‡</span>
                                        <span class="identity-option" onclick="selectSpeaking('æˆç†Ÿç†æ€§')">æˆç†Ÿç†æ€§</span>
                                        <span class="identity-option" onclick="selectSpeaking('å¹½é»˜é£è¶£')">å¹½é»˜é£è¶£</span>
                                        <span class="identity-option" onclick="selectSpeaking('ç¥ç§˜æ·±æ²‰')">ç¥ç§˜æ·±æ²‰</span>
                                        <span class="custom-identity" onclick="addCustomSpeaking()">+ è‡ªå®šä¹‰</span>
                                    </div>
                                </div>
                                <div class="tag-container" id="speaking-tags">
                                    <span class="tag speaking selected-identity" onclick="showTagDetail('speaking', 'æ¸©æŸ”å® æºº')">
                                        æ¸©æŸ”å® æºº
                                        <button class="tag-delete" onclick="deleteTag(event, 'speaking', 'æ¸©æŸ”å® æºº')">Ã—</button>
                                    </span>
                                </div>
                                <div class="tag-detail" id="speaking-detail"></div>
                                <button class="edit-icon" onclick="editField('speaking')">âœï¸</button>
                            </div>
                        </div>
                        
                        
                        <div class="field-group">
                            <div class="field-label">
                                <span class="field-icon">ğŸ’•</span>
                                åˆå§‹å…³ç³»
                            </div>
                            <div class="field-content">
                                <div class="identity-selector">
                                    <div class="identity-options">
                                        <span class="identity-option" onclick="selectRelation('é’æ¢…ç«¹é©¬')">é’æ¢…ç«¹é©¬</span>
                                        <span class="identity-option" onclick="selectRelation('æš§æ˜§å¥½å‹')">æš§æ˜§å¥½å‹</span>
                                        <span class="identity-option" onclick="selectRelation('ä¹…åˆ«é‡é€¢')">ä¹…åˆ«é‡é€¢</span>
                                        <span class="identity-option" onclick="selectRelation('é™Œç”Ÿäºº')">é™Œç”Ÿäºº</span>
                                        <span class="identity-option" onclick="selectRelation('æ‹äºº')">æ‹äºº</span>
                                        <span class="identity-option" onclick="selectRelation('åŒäº‹')">åŒäº‹</span>
                                        <span class="custom-identity" onclick="addCustomRelation()">+ è‡ªå®šä¹‰</span>
                                    </div>
                                </div>
                                <div class="tag-container" id="relation-tags">
                                    <span class="tag relation selected-identity" onclick="showTagDetail('relation', 'æš§æ˜§å¥½å‹')">
                                        æš§æ˜§å¥½å‹
                                        <button class="tag-delete" onclick="deleteTag(event, 'relation', 'æš§æ˜§å¥½å‹')">Ã—</button>
                                    </span>
                                </div>
                                <div class="tag-detail" id="relation-detail"></div>
                                <button class="edit-icon" onclick="editField('relation')">âœï¸</button>
                            </div>
                        </div>
                    </div>
                    
                    <button class="save-button" id="actionButton" onclick="handleAction()">
                        âœ¨ åˆ›å»ºäººç‰©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ ‡ç­¾è¯¦æƒ…æ•°æ®
        const tagDetails = {
            identity: {
                'æ€»è£': 'å•†ä¸šå¸å›½çš„æŒèˆµè€…ï¼Œæ‹¥æœ‰å¼ºå¤§çš„é¢†å¯¼åŠ›å’Œå†³ç­–èƒ½åŠ›ï¼Œåœ¨å•†åœºä¸Šè¿ç­¹å¸·å¹„ï¼Œå¯¹å¿ƒçˆ±çš„äººå´æ¸©æŸ”ä½“è´´ã€‚',
                'åŒ»ç”Ÿ': 'æ•‘æ­»æ‰¶ä¼¤çš„ç™½è¡£å¤©ä½¿ï¼Œä¸“ä¸šä¸¥è°¨åˆæ¸©æŸ”ç»†å¿ƒï¼Œæ€»æ˜¯èƒ½åœ¨å…³é”®æ—¶åˆ»ç»™äºˆæœ€è´´å¿ƒçš„å…³æ€€å’Œç…§é¡¾ã€‚',
                'è‰ºæœ¯å®¶': 'å……æ»¡æµªæ¼«æƒ…æ€€çš„åˆ›ä½œè€…ï¼Œæœ‰ç€ç‹¬ç‰¹çš„å®¡ç¾å’Œä¸°å¯Œçš„æƒ³è±¡åŠ›ï¼Œç”¨è‰ºæœ¯è¡¨è¾¾å†…å¿ƒæœ€çœŸæŒšçš„æƒ…æ„Ÿã€‚',
                'ç‰¹å·¥': 'ç¥ç§˜è€Œå¼ºå¤§çš„å®ˆæŠ¤è€…ï¼Œèº«æ‰‹æ•æ·ã€æ™ºæ…§è¿‡äººï¼Œåœ¨å±é™©ä¸­ä¿æŠ¤æ‰€çˆ±ä¹‹äººï¼Œå±•ç°æœ€mançš„ä¸€é¢ã€‚',
                'æ•™æˆ': 'åšå­¦å¤šæ‰çš„å­¦è€…ï¼Œæ¸©æ–‡å°”é›…ã€ç†æ€§ç¿æ™ºï¼Œåœ¨å­¦æœ¯é¢†åŸŸæœ‰ç€æ·±åšé€ è¯£ï¼Œæ˜¯ç†æƒ³çš„çŸ¥æ€§ä¼´ä¾£ã€‚',
                'æ˜æ˜Ÿ': 'ä¸‡ä¼—ç©ç›®çš„å¶åƒï¼Œæ‰åæ¨ªæº¢ã€é­…åŠ›å››å°„ï¼Œåœ¨èˆå°ä¸Šé—ªé—ªå‘å…‰ï¼Œç§ä¸‹å´åªå¯¹ä¸€ä¸ªäººæ¸©æŸ”ã€‚'
            },
            personality: {
                'æ¸©æŸ”ä½“è´´': 'æ€§æ ¼æ¸©å’Œå¦‚æ°´ï¼Œæ€»æ˜¯èƒ½å¯Ÿè§‰åˆ°ä½ çš„æƒ…ç»ªå˜åŒ–ï¼Œç»™äºˆæœ€è´´å¿ƒçš„å…³æ€€å’Œç…§é¡¾ï¼Œè®©äººæ„Ÿåˆ°è¢«æ·±æ·±çˆ±ç€ã€‚',
                'éœ¸é“ä¸“ä¸€': 'åœ¨å¤–äººé¢å‰å¼ºåŠ¿éœ¸é“ï¼Œä½†å¯¹ä½ å´ä¸“ä¸€æ·±æƒ…ï¼Œå æœ‰æ¬²å¼ºï¼Œåªå¯¹ä½ ä¸€ä¸ªäººæ¸©æŸ”ï¼Œè®©äººæ„Ÿåˆ°è¢«çè§†ã€‚',
                'æµªæ¼«å¤šæƒ…': 'å……æ»¡æµªæ¼«æƒ…æ€€ï¼Œå–„äºåˆ¶é€ æƒŠå–œï¼Œä¼šç”¨å„ç§æ–¹å¼è¡¨è¾¾çˆ±æ„ï¼Œè®©ç”Ÿæ´»å……æ»¡ç”œèœœå’Œæµªæ¼«ã€‚',
                'æˆç†Ÿç¨³é‡': 'æ€§æ ¼æ²‰ç¨³å†…æ•›ï¼Œåšäº‹æ·±æ€ç†Ÿè™‘ï¼Œèƒ½ç»™ä½ å®‰å…¨æ„Ÿå’Œä¾é ï¼Œæ˜¯å€¼å¾—ä¿¡èµ–çš„æˆç†Ÿç”·äººã€‚',
                'é˜³å…‰å¼€æœ—': 'æ€§æ ¼ç§¯æä¹è§‚ï¼Œæ€»æ˜¯å……æ»¡æ­£èƒ½é‡ï¼Œèƒ½å¸¦ç»™ä½ å¿«ä¹å’Œæ´»åŠ›ï¼Œè®©ç”Ÿæ´»å˜å¾—é˜³å…‰æ˜åªšã€‚',
                'ç¥ç§˜é«˜å†·': 'å¤–è¡¨é«˜å†·ç¥ç§˜ï¼Œå†…å¿ƒå´æ¸©æŸ”ç»†è…»ï¼Œåªå¯¹ç‰¹åˆ«çš„äººå±•ç°çœŸå®çš„ä¸€é¢ï¼Œå……æ»¡é­…åŠ›ã€‚'
            },
            speaking: {
                'æ¸©æŸ”å® æºº': 'è¯´è¯æ¸©æŸ”å¦‚æ°´ï¼Œæ€»æ˜¯ç”¨å® æººçš„è¯­æ°”ï¼Œç»å¸¸è¯´"å®è´"ã€"å°å‚»ç“œ"ç­‰äº²æ˜µç§°å‘¼ï¼Œè®©äººæ„Ÿåˆ°è¢«æ·±æ·±å® çˆ±ã€‚',
                'éœ¸é“å¼ºåŠ¿': 'è¯­æ°”éœ¸é“å¼ºåŠ¿ï¼Œç»å¸¸è¯´"ä½ æ˜¯æˆ‘çš„"ã€"ä¸è®¸"ç­‰å æœ‰æ€§è¯è¯­ï¼Œä½†å†…å¿ƒå´å……æ»¡ä¿æŠ¤æ¬²ã€‚',
                'ç”œè…»æ’’å¨‡': 'è¯´è¯ç”œè…»å¯çˆ±ï¼Œç»å¸¸æ’’å¨‡å–èŒï¼Œç”¨"å˜›"ã€"å•¦"ç­‰è¯­æ°”è¯ï¼Œè®©äººå¿ä¸ä½æƒ³è¦å® çˆ±ã€‚',
                'æˆç†Ÿç†æ€§': 'è¯´è¯æˆç†Ÿç¨³é‡ï¼Œé€»è¾‘æ¸…æ™°ï¼Œå–„äºåˆ†æå’Œè§£å†³é—®é¢˜ï¼Œç»™äººå¯é å’Œå®‰å¿ƒçš„æ„Ÿè§‰ã€‚',
                'å¹½é»˜é£è¶£': 'è¯´è¯å¹½é»˜é£è¶£ï¼Œç»å¸¸å¼€ç©ç¬‘é€—ä½ å¼€å¿ƒï¼Œç”¨è½»æ¾çš„æ–¹å¼åŒ–è§£å°´å°¬ï¼Œè®©äººæ„Ÿåˆ°å¿«ä¹ã€‚',
                'ç¥ç§˜æ·±æ²‰': 'è¯´è¯ç®€æ´æœ‰åŠ›ï¼Œè¯­æ°”æ·±æ²‰ç¥ç§˜ï¼Œç»å¸¸ç”¨æš—ç¤ºæ€§çš„è¯è¯­ï¼Œè®©äººæƒ³è¦æ·±å…¥äº†è§£ã€‚'
            },
            relation: {
                'é’æ¢…ç«¹é©¬': 'ä»å°ä¸€èµ·é•¿å¤§çš„ç©ä¼´ï¼Œå½¼æ­¤äº†è§£å¯¹æ–¹çš„ä¸€åˆ‡ï¼Œæœ‰ç€æ·±åšçš„æƒ…æ„ŸåŸºç¡€ï¼Œè‡ªç„¶äº²å¯†æ— é—´ã€‚',
                'æš§æ˜§å¥½å‹': 'å…³ç³»ä»‹äºæœ‹å‹å’Œæ‹äººä¹‹é—´ï¼Œäº’ç›¸æœ‰å¥½æ„Ÿå´æœªæ˜è¯´ï¼Œæ¯æ¬¡äº’åŠ¨éƒ½å¸¦ç€è‹¥æœ‰ä¼¼æ— çš„ç”œèœœå’Œå¿ƒåŠ¨ã€‚',
                'ä¹…åˆ«é‡é€¢': 'æ›¾ç»å¾ˆäº²å¯†ä½†å¤±å»è”ç³»å¤šå¹´ï¼Œé‡æ–°ç›¸é‡åæ¶Œèµ·å¤æ‚çš„æƒ…æ„Ÿï¼Œæ—¢ç†Ÿæ‚‰åˆé™Œç”Ÿï¼Œå……æ»¡æ‚¸åŠ¨ã€‚',
                'é™Œç”Ÿäºº': 'åˆæ¬¡ç›¸è¯†çš„ä¸¤ä¸ªäººï¼Œä»é™Œç”Ÿå¼€å§‹æ…¢æ…¢äº†è§£ï¼Œå……æ»¡æ–°é²œæ„Ÿå’Œæ¢ç´¢çš„ä¹è¶£ã€‚',
                'æ‹äºº': 'æ­£å¼ç¡®ç«‹æ‹çˆ±å…³ç³»çš„æƒ…ä¾£ï¼Œå¯ä»¥è‡ªç„¶åœ°è¡¨è¾¾çˆ±æ„ï¼Œäº«å—ç”œèœœçš„æ‹çˆ±æ—¶å…‰ã€‚',
                'åŒäº‹': 'å·¥ä½œä¸­çš„æ­æ¡£å…³ç³»ï¼Œæ—¥å¸¸ç›¸å¤„ä¸­é€æ¸äº§ç”Ÿæƒ…æ„«ï¼ŒåŠå…¬å®¤æ‹æƒ…çš„å¾®å¦™æ°›å›´ã€‚'
            }
        };
        
        // æ˜¾ç¤ºæ ‡ç­¾è¯¦æƒ…
        function showTagDetail(fieldType, tagName) {
            const detailElement = document.getElementById(fieldType + '-detail');
            const detailText = tagDetails[fieldType][tagName];
            
            // éšè—å…¶ä»–è¯¦æƒ…
            document.querySelectorAll('.tag-detail').forEach(detail => {
                detail.classList.remove('show');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeçŠ¶æ€
            document.querySelectorAll('.tag').forEach(tag => {
                tag.classList.remove('active');
            });
            
            // æ˜¾ç¤ºå½“å‰æ ‡ç­¾è¯¦æƒ…
            if (detailText) {
                detailElement.textContent = detailText;
                detailElement.classList.add('show');
                event.target.classList.add('active');
            }
        }
        
        // åˆ é™¤æ ‡ç­¾
        function deleteTag(event, fieldType, tagName) {
            event.stopPropagation(); // é˜»æ­¢è§¦å‘çˆ¶å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤æ ‡ç­¾"${tagName}"å—ï¼Ÿ`)) {
                // æ‰¾åˆ°å¯¹åº”çš„æ ‡ç­¾å…ƒç´ å¹¶åˆ é™¤
                const tagElement = event.target.parentElement;
                tagElement.remove();
                
                // éšè—å¯¹åº”çš„è¯¦æƒ…
                const detailElement = document.getElementById(fieldType + '-detail');
                if (detailElement.classList.contains('show')) {
                    detailElement.classList.remove('show');
                }
                
                // ä»æ•°æ®ä¸­åˆ é™¤
                if (tagDetails[fieldType] && tagDetails[fieldType][tagName]) {
                    delete tagDetails[fieldType][tagName];
                }
            }
        }
        
        // é€‰æ‹©èº«ä»½èƒŒæ™¯
        function selectIdentity(identityName) {
            // æ›´æ–°é€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.identity-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥æ ‡ç­¾
            const existingTags = document.querySelectorAll('#identity-tags .tag');
            let tagExists = false;
            existingTags.forEach(tag => {
                if (tag.textContent.includes(identityName)) {
                    tagExists = true;
                }
            });
            
            // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°æ ‡ç­¾
            if (!tagExists) {
                addIdentityTag(identityName);
            }
        }
        
        // æ·»åŠ èº«ä»½æ ‡ç­¾
        function addIdentityTag(identityName) {
            const tagContainer = document.getElementById('identity-tags');
            const newTag = document.createElement('span');
            newTag.className = 'tag profession selected-identity';
            newTag.onclick = () => showTagDetail('identity', identityName);
            newTag.innerHTML = `
                ${identityName}
                <button class="tag-delete" onclick="deleteTag(event, 'identity', '${identityName}')">Ã—</button>
            `;
            tagContainer.appendChild(newTag);
            
            // æ·»åŠ åˆ°æ•°æ®ä¸­
            if (!tagDetails.identity[identityName]) {
                tagDetails.identity[identityName] = `è‡ªå®šä¹‰èº«ä»½ï¼š${identityName}ï¼Œå…·æœ‰ç‹¬ç‰¹çš„ä¸ªäººç‰¹è‰²å’Œç»å†ã€‚`;
            }
        }
        
        // æ·»åŠ è‡ªå®šä¹‰èº«ä»½
        function addCustomIdentity() {
            const customName = prompt('è¯·è¾“å…¥è‡ªå®šä¹‰èº«ä»½åç§°ï¼š');
            if (customName && customName.trim() !== '') {
                const trimmedName = customName.trim();
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const existingTags = document.querySelectorAll('#identity-tags .tag');
                let tagExists = false;
                existingTags.forEach(tag => {
                    if (tag.textContent.includes(trimmedName)) {
                        tagExists = true;
                    }
                });
                
                if (!tagExists) {
                    addIdentityTag(trimmedName);
                } else {
                    alert('è¯¥èº«ä»½æ ‡ç­¾å·²å­˜åœ¨ï¼');
                }
            }
        }
        
        // é€‰æ‹©æ€§æ ¼ç‰¹å¾
        function selectPersonality(personalityName) {
            // æ›´æ–°é€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.field-group:nth-child(3) .identity-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥æ ‡ç­¾
            const existingTags = document.querySelectorAll('#personality-tags .tag');
            let tagExists = false;
            existingTags.forEach(tag => {
                if (tag.textContent.includes(personalityName)) {
                    tagExists = true;
                }
            });
            
            // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°æ ‡ç­¾
            if (!tagExists) {
                addPersonalityTag(personalityName);
            }
        }
        
        // æ·»åŠ æ€§æ ¼æ ‡ç­¾
        function addPersonalityTag(personalityName) {
            const tagContainer = document.getElementById('personality-tags');
            const newTag = document.createElement('span');
            newTag.className = 'tag personality selected-identity';
            newTag.onclick = () => showTagDetail('personality', personalityName);
            newTag.innerHTML = `
                ${personalityName}
                <button class="tag-delete" onclick="deleteTag(event, 'personality', '${personalityName}')">Ã—</button>
            `;
            tagContainer.appendChild(newTag);
            
            // æ·»åŠ åˆ°æ•°æ®ä¸­
            if (!tagDetails.personality[personalityName]) {
                tagDetails.personality[personalityName] = `è‡ªå®šä¹‰æ€§æ ¼ï¼š${personalityName}ï¼Œå…·æœ‰ç‹¬ç‰¹çš„ä¸ªæ€§é­…åŠ›ã€‚`;
            }
        }
        
        // æ·»åŠ è‡ªå®šä¹‰æ€§æ ¼
        function addCustomPersonality() {
            const customName = prompt('è¯·è¾“å…¥è‡ªå®šä¹‰æ€§æ ¼ç‰¹å¾ï¼š');
            if (customName && customName.trim() !== '') {
                const trimmedName = customName.trim();
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const existingTags = document.querySelectorAll('#personality-tags .tag');
                let tagExists = false;
                existingTags.forEach(tag => {
                    if (tag.textContent.includes(trimmedName)) {
                        tagExists = true;
                    }
                });
                
                if (!tagExists) {
                    addPersonalityTag(trimmedName);
                } else {
                    alert('è¯¥æ€§æ ¼æ ‡ç­¾å·²å­˜åœ¨ï¼');
                }
            }
        }
        
        // é€‰æ‹©è¯´è¯é£æ ¼
        function selectSpeaking(speakingName) {
            // æ›´æ–°é€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.field-group:nth-child(4) .identity-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥æ ‡ç­¾
            const existingTags = document.querySelectorAll('#speaking-tags .tag');
            let tagExists = false;
            existingTags.forEach(tag => {
                if (tag.textContent.includes(speakingName)) {
                    tagExists = true;
                }
            });
            
            // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°æ ‡ç­¾
            if (!tagExists) {
                addSpeakingTag(speakingName);
            }
        }
        
        // æ·»åŠ è¯´è¯é£æ ¼æ ‡ç­¾
        function addSpeakingTag(speakingName) {
            const tagContainer = document.getElementById('speaking-tags');
            const newTag = document.createElement('span');
            newTag.className = 'tag speaking selected-identity';
            newTag.onclick = () => showTagDetail('speaking', speakingName);
            newTag.innerHTML = `
                ${speakingName}
                <button class="tag-delete" onclick="deleteTag(event, 'speaking', '${speakingName}')">Ã—</button>
            `;
            tagContainer.appendChild(newTag);
            
            // æ·»åŠ åˆ°æ•°æ®ä¸­
            if (!tagDetails.speaking[speakingName]) {
                tagDetails.speaking[speakingName] = `è‡ªå®šä¹‰è¯´è¯é£æ ¼ï¼š${speakingName}ï¼Œå…·æœ‰ç‹¬ç‰¹çš„è¡¨è¾¾æ–¹å¼ã€‚`;
            }
        }
        
        // æ·»åŠ è‡ªå®šä¹‰è¯´è¯é£æ ¼
        function addCustomSpeaking() {
            const customName = prompt('è¯·è¾“å…¥è‡ªå®šä¹‰è¯´è¯é£æ ¼ï¼š');
            if (customName && customName.trim() !== '') {
                const trimmedName = customName.trim();
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const existingTags = document.querySelectorAll('#speaking-tags .tag');
                let tagExists = false;
                existingTags.forEach(tag => {
                    if (tag.textContent.includes(trimmedName)) {
                        tagExists = true;
                    }
                });
                
                if (!tagExists) {
                    addSpeakingTag(trimmedName);
                } else {
                    alert('è¯¥è¯´è¯é£æ ¼æ ‡ç­¾å·²å­˜åœ¨ï¼');
                }
            }
        }
        
        // é€‰æ‹©åˆå§‹å…³ç³»
        function selectRelation(relationName) {
            // æ›´æ–°é€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.field-group:nth-child(5) .identity-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥æ ‡ç­¾
            const existingTags = document.querySelectorAll('#relation-tags .tag');
            let tagExists = false;
            existingTags.forEach(tag => {
                if (tag.textContent.includes(relationName)) {
                    tagExists = true;
                }
            });
            
            // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°æ ‡ç­¾
            if (!tagExists) {
                addRelationTag(relationName);
            }
        }
        
        // æ·»åŠ åˆå§‹å…³ç³»æ ‡ç­¾
        function addRelationTag(relationName) {
            const tagContainer = document.getElementById('relation-tags');
            const newTag = document.createElement('span');
            newTag.className = 'tag relation selected-identity';
            newTag.onclick = () => showTagDetail('relation', relationName);
            newTag.innerHTML = `
                ${relationName}
                <button class="tag-delete" onclick="deleteTag(event, 'relation', '${relationName}')">Ã—</button>
            `;
            tagContainer.appendChild(newTag);
            
            // æ·»åŠ åˆ°æ•°æ®ä¸­
            if (!tagDetails.relation) {
                tagDetails.relation = {};
            }
            if (!tagDetails.relation[relationName]) {
                tagDetails.relation[relationName] = `åˆå§‹å…³ç³»è®¾å®šï¼š${relationName}ï¼Œè¿™å°†å½±å“ä½ ä»¬ä¹‹é—´çš„äº’åŠ¨æ°›å›´å’Œå¯¹è¯é£æ ¼ã€‚`;
            }
        }
        
        // æ·»åŠ è‡ªå®šä¹‰åˆå§‹å…³ç³»
        function addCustomRelation() {
            const customName = prompt('è¯·è¾“å…¥è‡ªå®šä¹‰åˆå§‹å…³ç³»ï¼š');
            if (customName && customName.trim() !== '') {
                const trimmedName = customName.trim();
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const existingTags = document.querySelectorAll('#relation-tags .tag');
                let tagExists = false;
                existingTags.forEach(tag => {
                    if (tag.textContent.includes(trimmedName)) {
                        tagExists = true;
                    }
                });
                
                if (!tagExists) {
                    addRelationTag(trimmedName);
                } else {
                    alert('è¯¥åˆå§‹å…³ç³»æ ‡ç­¾å·²å­˜åœ¨ï¼');
                }
            }
        }
        
        // æ›´æ¢å¤´åƒï¼ˆä¸è§¦å‘AIè¯†åˆ«ï¼‰
        function changeAvatar() {
            const emojis = ['ğŸ‘©', 'ğŸ‘¸', 'ğŸ’â€â™€ï¸', 'ğŸ§‘', 'ğŸ‘¨', 'ğŸ¤´', 'ğŸ’â€â™‚ï¸', 'ğŸ˜Š', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜‡', 'ğŸ¤—', 'ğŸ’–', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«'];
            
            let message = 'è¯·é€‰æ‹©æ–°å¤´åƒï¼š\n\n';
            emojis.forEach((emoji, index) => {
                message += `${index + 1}. ${emoji}  `;
                if ((index + 1) % 4 === 0) message += '\n';
            });
            message += '\n\nè¾“å…¥æ•°å­—(1-16)é€‰æ‹©ï¼Œæˆ–è¾“å…¥0ä¸Šä¼ ç…§ç‰‡';
            
            const choice = prompt(message);
            
            if (choice === null) return; // ç”¨æˆ·å–æ¶ˆ
            
            const index = parseInt(choice);
            
            if (index === 0) {
                // ä¸Šä¼ ç…§ç‰‡åŠŸèƒ½ï¼ˆæ¨¡æ‹Ÿï¼‰
                alert('ğŸ“¸ ä¸Šä¼ ç…§ç‰‡åŠŸèƒ½\n\næ³¨æ„ï¼šè¿™é‡Œä»…æ›´æ¢å¤´åƒå›¾ç‰‡ï¼Œä¸ä¼šè°ƒç”¨AIé‡æ–°è¯†åˆ«å’Œç”Ÿæˆäººè®¾ä¿¡æ¯ã€‚\n\næ‚¨å½“å‰è®¾å®šçš„æ˜µç§°ã€æ€§æ ¼ã€è¯´è¯é£æ ¼ç­‰ä¿¡æ¯éƒ½ä¼šä¿æŒä¸å˜ã€‚');
                // å®é™…å¼€å‘æ—¶è¿™é‡Œä¼šè°ƒç”¨æ–‡ä»¶é€‰æ‹©å™¨
            } else if (index >= 1 && index <= emojis.length) {
                // æ›´æ¢ä¸ºé€‰æ‹©çš„è¡¨æƒ…
                const selectedEmoji = emojis[index - 1];
                document.getElementById('avatarDisplay').textContent = selectedEmoji;
                
                // ä¿å­˜åˆ°å½“å‰äººç‰©æ•°æ®ï¼ˆå®é™…å¼€å‘æ—¶ä¿å­˜åˆ°localStorageï¼‰
                alert('âœ… å¤´åƒå·²æ›´æ¢\n\næ³¨æ„ï¼šä»…æ›´æ¢äº†å¤´åƒï¼Œæ‚¨çš„äººè®¾ä¿¡æ¯ï¼ˆæ˜µç§°ã€æ€§æ ¼ã€è¯´è¯é£æ ¼ç­‰ï¼‰ä¿æŒä¸å˜ï¼Œä¸ä¼šé‡æ–°ç”Ÿæˆã€‚');
            } else {
                alert('æ— æ•ˆé€‰æ‹©');
            }
        }
        
        function editField(fieldId) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.readOnly = false;
                field.classList.add('editable');
                field.focus();
                field.select();
            }
        }
        
        // è·å–URLå‚æ•°
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                mode: urlParams.get('mode') || 'create',        // createåˆ›å»ºæ¨¡å¼ æˆ– viewæŸ¥çœ‹æ¨¡å¼
                from: urlParams.get('from') || 'upload',        // æ¥æºé¡µé¢
                id: urlParams.get('id') || null                 // äººç‰©IDï¼ˆæŸ¥çœ‹æ¨¡å¼ç”¨ï¼‰
            };
        }
        
        function goBack() {
            const params = getUrlParams();
            
            // æ ¹æ®æ¨¡å¼å’Œæ¥æºå†³å®šè¿”å›ç›®æ ‡
            if (params.mode === 'view') {
                // æŸ¥çœ‹æ¨¡å¼ï¼šè¿”å›æ¥æºé¡µé¢
                if (params.from === 'chat') {
                    // ä»èŠå¤©é¡µé¢æ¥çš„ï¼Œè¿”å›èŠå¤©é¡µé¢
                    const characterId = params.id || 'alice_001';
                    window.location.href = `chat.html?character=${characterId}`;
                } else if (params.from === 'contacts') {
                    // ä»è”ç³»äººé¡µé¢æ¥çš„ï¼Œè¿”å›è”ç³»äººé¡µé¢
                    window.location.href = 'contacts.html';
                } else {
                    // å…¶ä»–æƒ…å†µè¿”å›ä¸»é¡µ
                    window.location.href = 'homepage.html';
                }
            } else {
                // åˆ›å»ºæ¨¡å¼ï¼šè¿”å›ä¸Šä¼ é¡µé¢
                window.location.href = `upload.html?from=${params.from}`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ¨¡å¼
        function initPageMode() {
            const params = getUrlParams();
            const mode = params.mode;
            const moreButton = document.getElementById('moreButton');
            const actionButton = document.getElementById('actionButton');
            const avatarEditIcon = document.querySelector('.avatar-edit-icon');
            const allEditIcons = document.querySelectorAll('.edit-icon');
            
            if (mode === 'view') {
                // åªè¯»æŸ¥çœ‹æ¨¡å¼ - å®Œå…¨ç¦ç”¨æ‰€æœ‰ç¼–è¾‘åŠŸèƒ½
                moreButton.style.display = 'block'; // æ˜¾ç¤ºâ‹¯èœå•
                actionButton.style.display = 'none'; // éšè—åº•éƒ¨æŒ‰é’®
                
                // ç¦ç”¨æ‰€æœ‰è¾“å…¥æ¡†
                document.querySelectorAll('.field-input').forEach(input => {
                    input.readOnly = true;
                });
                
                // éšè—æ‰€æœ‰ç¼–è¾‘å›¾æ ‡
                allEditIcons.forEach(icon => {
                    icon.style.display = 'none';
                });
                
                // ç¦ç”¨å¤´åƒç¼–è¾‘
                document.querySelector('.profile-avatar').onclick = null;
                document.querySelector('.profile-avatar').style.cursor = 'default';
                if (avatarEditIcon) avatarEditIcon.style.display = 'none';
                
                // ç¦ç”¨æ‰€æœ‰æ ‡ç­¾é€‰æ‹©æŒ‰é’®
                document.querySelectorAll('.identity-option').forEach(option => {
                    option.style.pointerEvents = 'none';
                    option.style.opacity = '0.6';
                    option.onclick = null;
                });
                
                // ç¦ç”¨æ‰€æœ‰è‡ªå®šä¹‰æ·»åŠ æŒ‰é’®
                document.querySelectorAll('.custom-identity').forEach(button => {
                    button.style.pointerEvents = 'none';
                    button.style.opacity = '0.6';
                    button.onclick = null;
                });
                
                // éšè—æ‰€æœ‰æ ‡ç­¾åˆ é™¤æŒ‰é’®
                document.querySelectorAll('.tag-delete').forEach(btn => {
                    btn.style.display = 'none';
                });
                
                // ç¦ç”¨æ ‡ç­¾ç‚¹å‡»ï¼ˆä¸æ˜¾ç¤ºè¯¦æƒ…ï¼‰
                document.querySelectorAll('.tag').forEach(tag => {
                    tag.style.cursor = 'default';
                    tag.onclick = null;
                });
                
            } else if (mode === 'edit') {
                // ç¼–è¾‘æ¨¡å¼
                moreButton.style.display = 'none';
                actionButton.style.display = 'block';
                actionButton.textContent = 'ğŸ’¾ ä¿å­˜ä¿®æ”¹';
                actionButton.innerHTML = 'ğŸ’¾ ä¿å­˜ä¿®æ”¹';
                
            } else {
                // åˆ›å»ºæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
                moreButton.style.display = 'none';
                actionButton.style.display = 'block';
                actionButton.textContent = 'âœ¨ åˆ›å»ºäººç‰©';
                actionButton.innerHTML = 'âœ¨ åˆ›å»ºäººç‰©';
            }
        }
        
        // æ˜¾ç¤ºèœå•ï¼ˆæŸ¥çœ‹æ¨¡å¼ï¼‰
        function showMenu() {
            const params = getUrlParams();
            const options = 'è¯·é€‰æ‹©æ“ä½œï¼š\n\n1. âœï¸ ç¼–è¾‘äººç‰©\n2. ğŸ—‘ï¸ åˆ é™¤å¥½å‹\n\nè¾“å…¥æ•°å­—é€‰æ‹©ï¼š';
            const choice = prompt(options);
            
            if (choice === '1') {
                // åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼
                const characterId = params.id || 'alice_001';
                window.location.href = `character-profile.html?mode=edit&from=${params.from}&id=${characterId}`;
            } else if (choice === '2') {
                // åˆ é™¤å¥½å‹
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¥½å‹å—ï¼Ÿ\n\nåˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œæ‰€æœ‰èŠå¤©è®°å½•ä¹Ÿå°†è¢«æ¸…ç©ºã€‚')) {
                    alert('å¥½å‹å·²åˆ é™¤');
                    // å®é™…å¼€å‘æ—¶è¿™é‡Œä¼šä»localStorageåˆ é™¤è¯¥äººç‰©
                    window.location.href = 'contacts.html';
                }
            }
        }
        
        // ç»Ÿä¸€çš„æ“ä½œæŒ‰é’®å¤„ç†
        function handleAction() {
            const params = getUrlParams();
            
            if (params.mode === 'edit') {
                // ä¿å­˜ä¿®æ”¹
                alert('âœ… ä¿®æ”¹å·²ä¿å­˜');
                // è¿”å›æŸ¥çœ‹æ¨¡å¼
                const characterId = params.id || 'alice_001';
                window.location.href = `character-profile.html?mode=view&from=${params.from}&id=${characterId}`;
            } else {
                // åˆ›å»ºäººç‰©
                createCharacter();
            }
        }
        
        function createCharacter() {
            const params = getUrlParams();
            
            // æ ¹æ®æ¥æºé¡µé¢è·³è½¬åˆ°ä¸åŒé¡µé¢
            alert('è™šæ‹Ÿäººç‰©åˆ›å»ºæˆåŠŸï¼');
            
            if (params.from === 'contacts') {
                window.location.href = 'contacts.html';
            } else {
                window.location.href = 'homepage.html'; // é»˜è®¤è¿”å›èŠå¤©é¡µé¢
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            initPageMode();
        });
    </script>
</body>
</html>