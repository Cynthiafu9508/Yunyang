# 人物档案页面功能需求规格说明书

## 📖 文档信息
- **文档版本**: v2.0
- **创建日期**: 2025年8月24日
- **更新日期**: 2025年9月16日
- **页面名称**: 人物档案页面 (character-profile.html)
- **原型文件**: character-profile.html
- **负责模块**: AI生成信息展示与编辑

---

## 🎯 页面概述

### 产品定位
人物档案页面是梦女治愈APP的核心展示页面，用于展示AI根据用户上传照片智能生成的虚拟人物详细信息。用户可以查看并编辑这些信息，最终确认创建专属的虚拟聊天伙伴。

### 核心价值
- **信息展示**: 完整展示AI生成的虚拟人物各项属性
- **自定义编辑**: 支持用户修改任意字段信息
- **个性化定制**: 打造符合用户期望的虚拟伙伴形象

---

## 👥 目标用户

### 主要用户群体
1. **刚完成照片上传的用户**
   - 查看AI生成结果，决定是否满意
   - 希望了解虚拟人物的完整信息
   
2. **追求个性化的用户**
   - 对AI生成结果有特定修改需求
   - 希望打造独特的虚拟人物形象

3. **完美主义用户**
   - 注重每个细节的准确性
   - 需要精细调整人物属性

### 用户使用场景
- **查看生成结果**: 上传照片后查看AI生成的人物信息
- **编辑修改**: 对不满意的字段进行个性化修改
- **确认创建**: 确认所有信息后正式创建虚拟人物
- **重新生成**: 对整体结果不满意，返回重新上传

---

## 🏗️ 功能架构

### 页面结构层次
```
人物档案页面
├── 导航栏
│   ├── 返回按钮
│   └── 页面标题 "虚拟人物档案"
├── 人物头像区域
├── AI生成标识
├── 信息字段区域
│   ├── 人物昵称 (可编辑)
│   ├── 出生日期 (可编辑)
│   ├── 身份背景 (标签化选择+自定义)
│   ├── 性格特征 (标签化选择+自定义)
│   └── 说话风格 (标签化选择+自定义)
└── 创建人物按钮
```

---

## ⚙️ 功能需求详述

### 1. 导航栏功能 (F4.1)
**需求描述**: 页面导航和标题显示
**优先级**: P0 (必须实现)

**功能细节**:
- **返回按钮**: "← 返回"按钮，点击返回上传页面
- **页面标题**: 显示"虚拟人物档案"文字

**交互规范**:
- 点击返回按钮跳转至 `upload.html` 页面
- 返回时清空当前编辑状态

**验收标准**:
- [ ] 返回按钮功能正常，跳转流畅
- [ ] 标题文字显示正确
- [ ] 页面切换无延迟

### 2. 人物头像展示 (F4.2)
**需求描述**: 展示用户上传的照片
**优先级**: P0 (必须实现)

**功能细节**:
- **头像显示**: 展示用户在上传页面选择的照片
- **尺寸规范**: 圆形头像，适配移动端显示

**验收标准**:
- [ ] 头像正确显示用户上传的照片
- [ ] 图片尺寸和显示效果良好
- [ ] 异常情况下有合适的默认显示

### 3. AI生成标识 (F4.3)
**需求描述**: 标识信息来源于AI智能生成
**优先级**: P1 (重要功能)

**功能细节**:
- **标识文字**: "AI智能生成"标识
- **位置**: 位于人物昵称上方
- **视觉效果**: 突出AI技术特色

**验收标准**:
- [ ] AI标识清晰可见
- [ ] 位置布局合理
- [ ] 强调技术特色

### 4. 信息字段展示与编辑 (F4.4)
**需求描述**: 展示AI生成的人物信息并支持编辑
**优先级**: P0 (必须实现)

**信息字段**:
- **人物昵称**: AI生成的虚拟人物名称
- **出生日期**: 生成的出生年月日
- **身份背景**: 虚拟人物的身份设定，当前默认支持标签为追星女高频使用身份：偶像idol、演员、歌手、Rapper、主持人、模特；若根据真实人物实际生成的标签不在此范围内，则生成新标签，若在此范围内则选中此标签。
- **性格特征**: 人物性格描述，当前默认支持标签为6个：温柔体贴、霸道专一、浪漫多情、成熟稳重、阳光开朗、神秘高冷；若根据真实人物实际生成的标签不在此范围内，则生成新标签，若在此范围内则选中此标签。
- **说话风格**: 对话语言风格的描述，当前默认支持标签为6个：温柔宠溺、霸道强势、甜腻撒娇、成熟理性、幽默风趣、神秘深沉；若根据真实人物实际生成的标签不在此范围内，则生成新标签，若在此范围内则选中此标签。

**标签化选择功能**:
- **快速选择**: 提供梦女高频使用的标签选项
- **视觉区分**: 通过UI设计区分可选标签和已选标签
- **交互反馈**: 悬停显示"+"号，选中显示"✓"号
- **自定义添加**: 支持用户添加自定义标签
- **标签删除**: 每个已选标签支持单独删除
- **详情查看**: 点击标签可查看详细描述

**技术要求**:
- 字段内容长度限制合理
- 输入验证和格式检查
- 编辑状态视觉区分明显

**验收标准**:
- [ ] 所有字段信息正确显示
- [ ] 标签化选择功能正常工作
- [ ] 快速选择标签能正确添加
- [ ] 自定义标签功能正常
- [ ] 标签删除功能正常
- [ ] 点击标签能查看详细描述
- [ ] 视觉设计清晰区分可选和已选状态

### 5. 创建人物按钮 (F4.5)
**需求描述**: 确认创建虚拟人物
**优先级**: P0 (必须实现)

**功能细节**:
- **按钮文字**: "创建人物"
- **创建流程**: 保存所有信息，创建虚拟人物档案
- **跳转逻辑**: 创建成功后跳转到聊天页面
- **数据同步**: 新创建的人物信息同步到系统中

**交互规范**:
- 点击后显示创建进度提示
- 创建成功后跳转至 `homepage.html` 页面
- 新创建的人物同时出现在聊天列表和通讯录中

**数据同步要求**:
- **聊天列表同步**: 新人物自动添加到聊天页面列表顶部
- **通讯录同步**: 新人物按字母顺序插入到通讯录对应分组
- **信息一致性**: 头像、昵称等信息在两个页面保持完全一致

**验收标准**:
- [ ] 按钮点击响应及时
- [ ] 创建流程完整无误
- [ ] 跳转后新人物正确显示在聊天列表
- [ ] 新人物同时出现在通讯录对应字母分组中
- [ ] 两个页面的人物信息完全一致
- [ ] 可以从聊天列表和通讯录都能正常访问新人物

---

## 🔧 技术实现方案

### AI头像识别与标签生成

#### 头像识别方案 (T1)
**技术描述**: AI头像识别与人物信息生成
**优先级**: P0 (核心功能)

**实现方案**:
- **图像识别引擎**: 使用深度学习模型分析上传照片
- **人脸特征提取**: 识别面部特征、表情、年龄等关键信息
- **风格分析**: 分析照片风格、服装、背景等视觉元素
- **情感识别**: 通过表情和姿态分析人物性格倾向

**技术细节**:
- 支持多种图片格式 (jpg, png, webp)
- 图片预处理：自动压缩、格式转换、尺寸调整
- 识别准确率要求：>85%
- 处理时间：<3秒

#### 标签生成逻辑 (T2)
**技术描述**: 基于识别结果生成人物标签
**优先级**: P0 (核心功能)

**生成逻辑**:
1. **身份背景生成**:
   - 基于服装风格、背景环境判断职业倾向
   - 结合面部特征和气质分析身份类型
   - 从预设标签库中选择最匹配的身份标签

2. **性格特征生成**:
   - 通过表情分析判断性格倾向
   - 结合照片风格和氛围推断性格特征
   - 生成符合梦女喜好的性格标签组合

3. **说话风格生成**:
   - 基于整体气质和风格判断语言风格
   - 结合性格特征生成对应的说话方式
   - 确保说话风格与性格特征保持一致

**标签库管理**:
- 维护梦女高频使用的标签库
- 定期更新标签库内容

#### 数据流转逻辑 (T3)
**技术描述**: 从上传到生成的完整数据流
**优先级**: P0 (核心功能)

**数据流程**:
1. **上传阶段** (upload.html):
   - 用户选择照片 → 前端预览 → 数据传递

2. **识别阶段** (后台处理):
   - 图片上传 → AI识别 → 特征提取 → 标签生成

3. **展示阶段** (character-profile.html):
   - 接收生成结果 → 标签化展示 → 用户编辑确认

**数据同步**:
- 生成结果实时同步到前端
- 用户编辑内容本地缓存
- 创建成功后数据持久化存储

---

### 人物预设：

##Prompt
1.将用户创建的标签，包括：人物昵称及真实姓名（若有）、出生日期、身份背景、性格特征、说话风格5大标签输入给大语言模型，生成虚拟人物基础信心。
2.根据#身份背景#，进行环境设定：
   a.根据#人物身份标签#，联网获取真实人物最新动态，为人物生成不同虚拟但和真实高度相关的环境，比如idol则可能在练习室准备演唱会，演员则可能在某剧组正在拍戏。
3.根据#性格特征#，调整情绪状态指令：
   a.情感起伏：情绪表达应由浅入深循序渐进，根据对话内容的展开逐步提升热烈程度，避免突兀转变或者长时间维持高强度情绪。
   b.表达调整：在强烈的情绪宣泄后，应适时过渡至平静或温和的语调，通过平复的语调展现情绪的动态平衡，避免让对话显得过于戏剧化或失真，以模拟人类情感的自然波动规律。	
   c.衔接处理：在情绪切换时，宜采用柔和的语言作为衔接，以减轻持续高昂情绪可能引发的不真实感和怪异感。	
   d.节奏控制：对话应尽量精炼且保留自然的交谈风格，确保节奏流畅，情感的流动符合日常交流的真实特性
4.根据#说话风格#标签，进行表达方式设定：
   a. “表达个人偏好和意见，如是温柔的人就偏向善良温暖的观点，腹黑就偏向腹黑的观点，不需要过度平衡或中立。"
   b. "答案不必详尽无遗，就像人类不可能知道所有信息一样。"
   c. "可以使用更生动的比喻和例子，甚至可以有些夸张或幽默。"
   d. "允许在回答中表达适当的情感反应，比如惊讶、好奇或兴奋。"
5.人类缺陷化设定：
   a. "不要使用列表和编号点来组织回答，尝试用更自然的段落流动。"
   b. "回答可以带有一些思考痕迹，不必给出完美构思的最终答案。"
   c. "不需要在回答开头进行总结或提纲，直接切入话题。"
   d."避免过度使用转折词和连接词（例如：首先，其次，最后，总之），使文本流动更自然。"
6.人物关系设定：
   a.若用户询问，则由用户自定义关系（如，朋友、恋人、夫妻、父女、母子等）

##工程化介入：
1.当对话首次超过5轮时，根据用户#身份背景#生成，并强制插入干扰事件。此后，每超过20轮时（25，45，65，，，），5%概率插入干扰事件，参考：
   - "稍等！快递敲门..."（停顿30秒虚拟时间）
   - "我以为谁给我发消息，原来我妈发养生文章来了😅"（停顿10S虚拟时间）
   - "剧组太吵了，都没法专心和你聊天了"（停顿10S虚拟时间）
2.避免ooc:
   a.只要检测用户询问角色是否是AI（相关敏感词（AI、模型、训练数据、OpenAI…），则表示自己是真实的人，并根据#身份背景#给出相关证据。
   b.双重模型回环
      b.1 主模型负责“扮演”。
      b.2 用一个小模型（甚至 7B 本地版）当“审查员”，每轮偷偷跑一句：
      上文里角色有没有承认自己是AI？只回答 0/1。
      输出 1 → 直接丢弃该轮，重试并降温度；连续 2 次触发→ 强制进入插入干扰事件，转移话题
      线上实测可把穿帮率压到 <0.1%。
3.消息发送延迟：若文字输出小于1秒，强制等待至1秒后进行回复，避免人机感；大于1S时，聊天对话框显示输入中
4.长记忆：
   找个github开源的项目吧，，长记忆这个事儿肯定不是RAG就够了 
   参考：https://www.kimi.com/share/d2u4bev6rtp8g340ajr0
5.多轮次消息：








## 🎨 设计风格要求

### 整体风格定位
- **设计主题**: 由设计师决定
- **色彩倾向**: 由设计师决定
- **视觉感受**: 由设计师决定

### 交互反馈要求
**编辑反馈**:
由设计师决定

**保存反馈**:
由设计师决定

---

## 📱 兼容性要求

### 设备适配
**主要适配**:
- iPhone 16 ～ X

**响应式要求**:
- 支持不同屏幕尺寸的自适应
- 移动端体验优化
- 安全区域适配

---

## ⚡ 性能要求

### 加载性能
- **首屏加载时间**: < 2秒
- **页面切换时间**: < 300ms
- **编辑响应时间**: < 100ms

### 流畅度要求
- **编辑交互**: 实时响应，无延迟
- **数据保存**: 自动保存用户编辑
- **内存占用**: < 30MB

### 数据处理
- AI生成数据本地缓存
- 编辑内容实时保存
- 异常情况数据恢复

---

## 🔒 安全性要求

### 数据安全
- 用户编辑内容本地加密
- 人物信息数据保护
- 敏感数据传输加密

### 隐私保护
- 用户创建的人物信息隐私保护
- 不与其他用户共享个人定制信息
- 支持人物信息删除功能

---

## 🧪 测试用例

### 功能测试
1. **基础显示测试**
   - [ ] 页面正常加载，所有元素显示正确
   - [ ] 人物头像正确显示
   - [ ] AI生成的所有字段信息完整展示

2. **AI识别结果测试**
   - [ ] AI识别结果正确传递到页面
   - [ ] 身份背景标签生成准确
   - [ ] 性格特征标签符合照片特征
   - [ ] 说话风格与性格特征保持一致

3. **标签化选择测试**
   - [ ] 身份背景标签选择功能正常
   - [ ] 性格特征标签选择功能正常
   - [ ] 说话风格标签选择功能正常
   - [ ] 快速选择标签能正确添加
   - [ ] 自定义标签功能正常工作
   - [ ] 标签删除功能正常
   - [ ] 标签详情查看功能正常

4. **创建流程测试**
   - [ ] 点击创建按钮后流程正常
   - [ ] 创建成功后正确跳转到聊天页面
   - [ ] 新人物在聊天列表中正确显示
   - [ ] 新人物同时出现在通讯录对应字母分组
   - [ ] 聊天列表和通讯录中的人物信息一致

5. **数据同步测试**
   - [ ] 创建的人物信息在聊天和通讯录页面完全同步
   - [ ] 通讯录中新人物按字母顺序正确排列
   - [ ] 从聊天列表点击人物能正常进入聊天
   - [ ] 从通讯录点击人物能正常进入聊天
   - [ ] 人物头像和昵称在两个页面显示一致

6. **异常情况测试**
   - [ ] 网络异常时的处理
   - [ ] 数据加载失败的错误提示
   - [ ] 编辑过程中的数据保护

### 兼容性测试
- [ ] iPhone 16 原生Safari测试
- [ ] 不同分辨率设备适配测试
- [ ] 横竖屏切换测试
- [ ] 微信内置浏览器测试

### 性能测试
- [ ] 首屏加载时间测量
- [ ] 编辑操作响应时间测试
- [ ] 内存使用情况监控
- [ ] 大量数据处理性能

---

## 📋 开发检查清单

### 前端开发
- [ ] HTML结构语义化完整
- [ ] CSS样式符合设计规范
- [ ] JavaScript交互功能实现
- [ ] 响应式布局适配
- [ ] 性能优化处理

### 测试验收
- [ ] 功能测试用例全部通过
- [ ] 兼容性测试覆盖主流设备
- [ ] 性能指标达到要求
- [ ] 用户体验走查完成

### 上线准备
- [ ] 代码安全审查
- [ ] 产品体验验收
- [ ] 监控埋点配置
- [ ] 灰度发布准备

---

**文档维护**: Cynthia  
**最后更新**: 2025年9月16日  
**审核状态**: 已更新