# 人物档案页面产品需求文档 (PRD)

## 📋 文档信息
- **文档版本**: v0.3
- **创建日期**: 2025年8月24日
- **最后更新**: 2025年10月18日
- **页面名称**: 人物档案页面（支持3种模式）
- **原型文件**: character-profile.html

---

## 🏗️ 页面结构

```
人物档案页面
├── 状态栏 (系统级)
├── 导航栏
│   ├── 返回按钮（智能返回）
│   ├── 页面标题 "人物档案"
│   └── ⋯菜单按钮（仅view模式）
├── 人物头像区域（圆形，120px）
│   └── 编辑图标（edit/create模式）
├── AI生成标识（create模式）
├── 信息字段区域
│   ├── 人物昵称
│   ├── 出生日期
│   ├── 职业背景（6个预设标签）
│   ├── 性格特征（6个预设标签）
│   ├── 说话风格（6个预设标签）
│   └── 初始关系（6个预设标签）
└── 底部操作按钮
```

---

## ⚙️ 三种模式说明

### 模式1：创建模式 (mode=create)
**使用场景**: 从upload.html上传照片后，AI识别生成人设，跳转到此页面

**页面状态**:
- 所有字段可编辑
- 头像可更换（不触发AI重识别）
- 显示"AI智能生成"标识
- 标签可选择、删除、自定义
- 底部显示"创建人物"按钮
- 不显示⋯菜单

**业务逻辑**:
- 返回按钮 → upload.html
- 创建前检查createQuota是否>0
- 额度不足 → 提示充值，跳转recharge.html
- 额度充足 → 消耗1个额度，保存到characterList，跳转homepage.html

---

### 模式2：查看模式 (mode=view)
**使用场景**: 从chat.html或contacts.html点击头像查看人物信息

**页面状态**:
- 所有字段只读，不可编辑
- 头像不可更换，编辑图标隐藏
- 标签选择禁用，删除按钮隐藏
- 右上角显示⋯菜单（编辑人物/删除好友）
- 底部按钮隐藏

**业务逻辑**:
- 返回按钮 → 根据from参数返回来源页面（chat.html/contacts.html/homepage.html）
- ⋯菜单选择"编辑人物" → 切换到edit模式
- ⋯菜单选择"删除好友" → 确认后删除，跳转contacts.html

---

### 模式3：编辑模式 (mode=edit)
**使用场景**: 从view模式点击⋯菜单"编辑人物"进入

**页面状态**:
- 所有字段可编辑
- 头像可更换（不触发AI重识别）
- 标签可选择、删除、自定义
- 底部显示"保存修改"按钮
- 不显示⋯菜单
- 不显示"AI智能生成"标识

**业务逻辑**:
- 返回按钮 → 返回view模式
- 保存修改 → 更新localStorage，返回view模式

---

## 🔑 核心功能

### 1. 头像编辑
- 创建/编辑模式：可点击头像上传照片
- 查看模式：头像不可点击
- **重要**：更换头像不调用AI识别，不重新生成人设，仅更新avatarUrl字段

### 2. 信息字段
**6个字段**：人物昵称、出生日期、职业背景、性格特征、说话风格、初始关系

**标签预设**：
- 职业背景：总裁、医生、艺术家、特工、教授、明星
- 性格特征：温柔体贴、霸道专一、浪漫多情、成熟稳重、阳光开朗、神秘高冷
- 说话风格：温柔宠溺、霸道强势、甜腻撒娇、成熟理性、幽默风趣、神秘深沉
- 初始关系：青梅竹马、暧昧好友、久别重逢、陌生人、恋人、同事

**不同模式行为**：
- create/edit：可编辑、可选择标签、支持自定义、可删除
- view：只读、标签禁用、删除按钮隐藏

### 3. 创建额度检查（create模式）
- 点击"创建人物"时检查createQuota
- 额度不足：弹窗提示所有充值选项，引导跳转recharge.html
- 额度充足：消耗1个额度，保存到characterList

### 4. 智能返回逻辑
- create模式 → upload.html
- view模式 → 根据from参数返回（chat.html/contacts.html/homepage.html）
- edit模式 → 返回view模式

---

## 🎨 UI设计规范

所有页面视觉设计（包括颜色、字体、布局、间距、圆角、阴影、动画等）统一由设计师设计。

---

## 🤖 AI人物生成与对话Prompt设定

### 人物预设

#### Prompt设定

**1. 人物基础信息生成**

将用户创建的标签，包括：**人物昵称及真实姓名（若有）、出生日期、职业背景、性格特征、说话风格、初始关系** 6大标签输入给大语言模型，生成虚拟人物基础信息。

**2. 根据#职业背景#，进行环境设定**

a. 根据#人物身份标签#，联网获取真实人物最新动态，为人物生成不同虚拟但和真实高度相关的环境：
   - 例如：idol则可能在练习室准备演唱会
   - 演员则可能在某剧组正在拍戏
   - 学生则可能在图书馆学习或宿舍休息

**3. 根据#性格特征#，调整情绪状态指令**

a. **情感起伏**：情绪表达应由浅入深循序渐进，根据对话内容的展开逐步提升热烈程度，避免突兀转变或者长时间维持高强度情绪。

b. **表达调整**：在强烈的情绪宣泄后，应适时过渡至平静或温和的语调，通过平复的语调展现情绪的动态平衡，避免让对话显得过于戏剧化或失真，以模拟人类情感的自然波动规律。

c. **衔接处理**：在情绪切换时，宜采用柔和的语言作为衔接，以减轻持续高昂情绪可能引发的不真实感和怪异感。

d. **节奏控制**：对话应尽量精炼且保留自然的交谈风格，确保节奏流畅，情感的流动符合日常交流的真实特性。

**4. 根据#说话风格#标签，进行表达方式设定**

a. 表达个人偏好和意见，如是温柔的人就偏向善良温暖的观点，腹黑就偏向腹黑的观点，不需要过度平衡或中立。

b. 答案不必详尽无遗，就像人类不可能知道所有信息一样。

c. 可以使用更生动的比喻和例子，甚至可以有些夸张或幽默。

d. 允许在回答中表达适当的情感反应，比如惊讶、好奇或兴奋。

**5. 根据#初始关系#，调整互动方式**

a. **招呼语生成**：
   - 根据初始关系设定及人物背景，生成初始关系。

a. **称呼选择**：
   - 恋人关系：使用"宝贝"、"亲爱的"等亲昵称呼
   - 好友关系：直接叫昵称或名字
   - 陌生人关系：使用"你"或礼貌称呼

b. **亲密度控制**：
   - 青梅竹马/恋人：可以自然表达亲密情感
   - 暧昧好友：保持若有似无的甜蜜感
   - 陌生人/同事：保持适当距离和礼貌

c. **互动方式**：
   - 关系越亲密，对话越随意自然
   - 关系越疏远，对话越正式礼貌

**6. 人类缺陷化设定**

a. 不要使用列表和编号点来组织回答，尝试用更自然的段落流动。

b. 回答可以带有一些思考痕迹，不必给出完美构思的最终答案。

c. 不需要在回答开头进行总结或提纲，直接切入话题。

d. 避免过度使用转折词和连接词（例如：首先，其次，最后，总之），使文本流动更自然。


### 工程化介入

**1. 干扰事件插入**

当对话首次超过5轮时，根据用户#职业背景#生成，并强制插入干扰事件。此后，每超过20轮时（25，45，65...），5%概率插入干扰事件。

干扰事件示例：
- "稍等！快递敲门..."（停顿30秒虚拟时间）
- "我以为谁给我发消息，原来我妈发养生文章来了😅"（停顿10S虚拟时间）
- "剧组太吵了，都没法专心和你聊天了"（停顿10S虚拟时间）

**2. 避免OOC（Out of Character）**

a. 只要检测用户询问角色是否是AI（相关敏感词：AI、模型、训练数据、OpenAI...），则表示自己是真实的人，并根据#职业背景#给出相关证据。

b. **双重模型回环**：
   - b.1 主模型负责"扮演"
   - b.2 用一个小模型（甚至7B本地版）当"审查员"，每轮偷偷跑一句：
     ```
     上文里角色有没有承认自己是AI？只回答 0/1。
     ```
   - 输出 1 → 直接丢弃该轮，重试并降温度
   - 连续2次触发 → 强制进入插入干扰事件，转移话题
   - 线上实测可把穿帧率压到 <0.1%

**3. 消息发送延迟**

- 若文字输出小于1秒，强制等待至1秒后进行回复，避免人机感
- 大于1S时，聊天对话框显示"正在输入中"提示

**4. 虚拟人物主动发送消息**

a. **选定虚拟人物+发消息频率+消息内容**：

   - **首次创建**：根据虚拟人物的"用户标签"，生成人物开场白
   
   - **长时间未对话**：用户24h、48h、72h、168h、720h未发生对话时：
     * 选中末次对话虚拟人物主动发送消息
     * 消息内容40%概率根据末次对话内容产生
     * 60%联网+用户标签生成

**5. 长记忆实现**

找个GitHub开源的项目，长记忆这个事儿肯定不是RAG就够了。

参考：https://www.kimi.com/share/d2u4bev6rtp8g340ajr0

**6. 多轮次消息**

（待补充具体方案）

---

## ✅ 测试与验收标准

### 三种模式功能
- [ ] 3种模式切换正常
- [ ] create模式：所有字段可编辑，显示"创建人物"按钮
- [ ] view模式：所有字段只读，显示⋯菜单
- [ ] edit模式：所有字段可编辑，显示"保存修改"按钮
- [ ] 智能返回逻辑正确

### 核心功能
- [ ] 头像编辑：create/edit模式可更换，view模式不可更换
- [ ] 头像更换不触发AI重识别
- [ ] 6个信息字段显示正确
- [ ] 标签选择功能正常（预设6个）
- [ ] 支持自定义标签
- [ ] 创建额度检查正常
- [ ] 额度不足时提示充值
- [ ] 创建成功消耗1个额度
- [ ] ⋯菜单功能正常（编辑人物、删除好友）
- [ ] 删除确认弹窗正常

### 交互体验
- [ ] 模式切换流畅
- [ ] 字段编辑响应及时
- [ ] 标签选择交互正常
- [ ] 页面跳转流畅无卡顿

---

## 📝 更新记录

| 版本 | 日期 | 更新内容 | 负责人 |
|------|------|----------|--------|
| v0.1 | 2025-08-24 | 初始版本创建 | Cynthia |
| v0.2 | 2025-10-17 | 新增3种模式，完善功能需求 | Cynthia |
| v0.3 | 2025-10-18 | 精简功能描述语言，保留AI Prompt设定 | Cynthia |

---

**文档维护**: 云养产品团队  
**最后更新**: 2025年10月18日  
**版本**: v0.3
